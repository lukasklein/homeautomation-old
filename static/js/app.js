// Generated by CoffeeScript 1.4.0
(function() {
  var timeselectWidget;

  timeselectWidget = function(cid, hght) {
    var boxwidth, canvas, context, doDrag, draw, height, i, init, isdragging, mouse, mousestart, selected, selected_temp, startDrag, stopDrag;
    selected = [
      (function() {
        var _i, _results;
        _results = [];
        for (i = _i = 0; _i <= 48; i = ++_i) {
          _results.push(0);
        }
        return _results;
      })()
    ];
    selected = selected[0];
    selected_temp = [
      (function() {
        var _i, _results;
        _results = [];
        for (i = _i = 0; _i <= 48; i = ++_i) {
          _results.push(0);
        }
        return _results;
      })()
    ];
    selected_temp = selected_temp[0];
    context = null;
    canvas = null;
    mousestart = {};
    mouse = {};
    isdragging = false;
    boxwidth = 0;
    height = 0;
    startDrag = function(e) {
      mousestart.x = e.pageX - this.offsetLeft;
      mousestart.y = e.pageY - this.offsetTop;
      return isdragging = true;
    };
    stopDrag = function(e) {
      var _i;
      for (i = _i = 0; _i <= 48; i = ++_i) {
        selected[i] = (selected[i] + selected_temp[i]) % 2;
      }
      return isdragging = false;
    };
    doDrag = function(e) {
      var _i, _j, _ref, _ref1, _ref2, _ref3;
      if (isdragging) {
        mouse.x = e.pageX - this.offsetLeft;
        mouse.y = e.pageY - this.offsetTop;
        selected_temp = [
          (function() {
            var _i, _results;
            _results = [];
            for (i = _i = 0; _i <= 48; i = ++_i) {
              _results.push(0);
            }
            return _results;
          })()
        ];
        selected_temp = selected_temp[0];
        if (mouse.x < mousestart.x) {
          for (i = _i = _ref = mouse.x - boxwidth, _ref1 = mousestart.x; _ref <= _ref1 ? _i <= _ref1 : _i >= _ref1; i = _ref <= _ref1 ? ++_i : --_i) {
            selected_temp[i / boxwidth] = 1;
          }
        } else {
          for (i = _j = _ref2 = mousestart.x - boxwidth, _ref3 = mouse.x; _ref2 <= _ref3 ? _j <= _ref3 : _j >= _ref3; i = _ref2 <= _ref3 ? ++_j : --_j) {
            selected_temp[i / boxwidth] = 1;
          }
        }
        return draw();
      }
    };
    init = function(cvs, hght) {
      height = hght;
      canvas = document.getElementById(cvs);
      context = canvas.getContext('2d');
      boxwidth = canvas.width / 48;
      return $(canvas).mousedown(startDrag).mouseup(stopDrag).mousemove(doDrag);
    };
    init(cid, hght);
    draw = function() {
      var time, _i, _results;
      canvas.width = canvas.width;
      context.strokeStyle = 'rgb(0,0,0)';
      context.lineWidth = 1;
      context.font = '10px Helvetica';
      context.textAlign = 'center';
      _results = [];
      for (i = _i = 0; _i <= 48; i = ++_i) {
        context.strokeRect(i * boxwidth, 0, boxwidth, height);
        if ((selected[i] + selected_temp[i]) % 2) {
          context.fillStyle = 'rgba(255,0,0, 0.5)';
          context.fillRect(i * boxwidth, 0, boxwidth, height);
        }
        context.fillStyle = 'rgb(0,0,0)';
        time = i / 2;
        if (time >= 12) {
          time -= 12;
          if (time === 0) {
            time = 12;
          }
          time += 'pm';
        } else {
          if (time === 0) {
            time = 12;
          }
          time += 'am';
        }
        if ((i + 1) % 2) {
          _results.push(context.fillText(time, i * boxwidth + boxwidth, height + 10));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };
    return {
      draw: draw
    };
  };

  $(function() {
    var testw;
    testw = timeselectWidget('main_light', 20);
    return testw.draw();
  });

}).call(this);
